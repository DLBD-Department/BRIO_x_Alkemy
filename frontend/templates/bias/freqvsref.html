{% extends 'base.html' %}

{% block title %}
FreqvsRef
{% endblock %}

{% block content %}
<div class="px-4 py-5 my-2 text-center">
	<h1 class="display-5 fw-bold text-body-emphasis">Freq vs Ref Analysis</h1>
	<div class="col-lg-6 mx-auto">
	<p class="lead mb-4">Check how much the predictions for the target variable differ with respect to a reference distribution provided as input, overall and conditioning to the categories of other selected predictors. <br>
Using the max as aggregating function, you are checking the "worst case scenario". Using the min as aggregating function, you are checking the "best case scenario"..</p>
</div>
{% include 'bias/upload_freqvsref.html' %}
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='js/handle_parameters.js') }}"></script>
<script type="text/javascript">
function handle_stdev_refs() {
    let data = new FormData();
    var rootvar = document.getElementById("root_var");
    var selected_option_rv = rootvar.options[rootvar.selectedIndex];
    var predvar = document.getElementById("predictions");
    var selected_option_pr = predvar.options[predvar.selectedIndex];
    if (selected_option_pr.value != "id" && selected_option_rv.value != "id") {
      data.append("rv_selected", selected_option_rv.value);
      data.append("pr_selected", selected_option_pr.value);
      const freqvsref_url = "http://" + "{{ local_ip }}" + ":5000/bias/freqvsref";
      const stdev_id = document.getElementById("stdev-label");
      const preds_id = document.getElementById("ref_dist");
      //console.log(stdev_id.outerHTML)
      //console.log(selected_option_rv.value)
      fetch(freqvsref_url, {
      "method": "POST",
      "body": data
          }).then((response) => response.json())
        .then((data) => {
          stdev_id.outerHTML = data.response_stdev;
          preds_id.innerHTML = data.response_refs;
        })
  } 
};

document.addEventListener("DOMContentLoaded", function() {
    var fromroot = document.getElementById("root_var");
    var frompred = document.getElementById("predictions");
    fromroot.addEventListener("change", handle_stdev_refs);
    frompred.addEventListener("change", handle_stdev_refs);
});
</script>
{% endblock %}

{% block footer %}
    <div class="modal-footer">
        <a href="/bias/freqvsref/results"><button type="button" class="btn btn-lg btn-secondary" data-dismiss="modal">Run</button>
    </div>
{% endblock %}





